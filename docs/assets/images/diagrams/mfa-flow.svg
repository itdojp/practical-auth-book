<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="700" viewBox="0 0 800 700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title-text { font-family: 'Noto Sans JP', sans-serif; font-size: 18px; font-weight: bold; fill: #2c3e50; }
      .process-box { fill: #e6f3ff; stroke: #3498db; stroke-width: 2; }
      .decision-box { fill: #fff3cd; stroke: #f39c12; stroke-width: 2; }
      .success-box { fill: #d4edda; stroke: #28a745; stroke-width: 2; }
      .error-box { fill: #f8d7da; stroke: #dc3545; stroke-width: 2; }
      .action-box { fill: #d5f4e6; stroke: #27ae60; stroke-width: 2; }
      .text-label { font-family: 'Noto Sans JP', sans-serif; font-size: 12px; fill: #2c3e50; }
      .small-text { font-family: 'Noto Sans JP', sans-serif; font-size: 10px; fill: #7f8c8d; }
      .flow-arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .yes-arrow { stroke: #28a745; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .no-arrow { stroke: #dc3545; stroke-width: 2; fill: none; marker-end: url(#arrowhead-red); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#28a745"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#dc3545"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" class="title-text" text-anchor="middle">多要素認証（MFA）フロー</text>

  <!-- Start: Login Request -->
  <rect x="325" y="60" width="150" height="40" class="process-box" rx="20"/>
  <text x="400" y="85" class="text-label" text-anchor="middle">ログインリクエスト</text>

  <!-- Username/Password -->
  <rect x="325" y="130" width="150" height="40" class="process-box" rx="5"/>
  <text x="400" y="155" class="text-label" text-anchor="middle">ユーザー名/パスワード</text>

  <!-- Valid Credentials? -->
  <polygon points="400,200 480,230 400,260 320,230" class="decision-box"/>
  <text x="400" y="235" class="text-label" text-anchor="middle">認証情報</text>
  <text x="400" y="250" class="small-text" text-anchor="middle">有効？</text>

  <!-- Authentication Failed -->
  <rect x="100" y="210" width="150" height="40" class="error-box" rx="5"/>
  <text x="175" y="235" class="text-label" text-anchor="middle">認証失敗</text>

  <!-- MFA Enabled? -->
  <polygon points="400,300 480,330 400,360 320,330" class="decision-box"/>
  <text x="400" y="335" class="text-label" text-anchor="middle">MFA有効？</text>

  <!-- MFA Method Selection -->
  <polygon points="400,400 480,430 400,460 320,430" class="decision-box"/>
  <text x="400" y="435" class="text-label" text-anchor="middle">MFA方式</text>

  <!-- SMS -->
  <rect x="150" y="490" width="120" height="40" class="action-box" rx="5"/>
  <text x="210" y="515" class="text-label" text-anchor="middle">SMS送信</text>

  <!-- TOTP -->
  <rect x="340" y="490" width="120" height="40" class="action-box" rx="5"/>
  <text x="400" y="515" class="text-label" text-anchor="middle">TOTP要求</text>

  <!-- Hardware Token -->
  <rect x="530" y="490" width="120" height="40" class="action-box" rx="5"/>
  <text x="590" y="515" class="text-label" text-anchor="middle">ハードウェア</text>

  <!-- Enter Code -->
  <rect x="325" y="560" width="150" height="40" class="process-box" rx="5"/>
  <text x="400" y="585" class="text-label" text-anchor="middle">コード入力</text>

  <!-- Valid Code? -->
  <polygon points="400,630 480,660 400,690 320,660" class="decision-box"/>
  <text x="400" y="665" class="text-label" text-anchor="middle">コード有効？</text>

  <!-- Retry Check -->
  <polygon points="550,630 630,660 550,690 470,660" class="decision-box"/>
  <text x="550" y="660" class="small-text" text-anchor="middle">再試行</text>
  <text x="550" y="675" class="small-text" text-anchor="middle">回数？</text>

  <!-- Login Success -->
  <rect x="325" y="730" width="150" height="40" class="success-box" rx="5"/>
  <text x="400" y="755" class="text-label" text-anchor="middle">ログイン成功</text>

  <!-- Account Locked -->
  <rect x="620" y="730" width="150" height="40" class="error-box" rx="5"/>
  <text x="695" y="755" class="text-label" text-anchor="middle">アカウントロック</text>

  <!-- End -->
  <ellipse cx="400" cy="820" rx="50" ry="25" fill="#f8f9fa" stroke="#2c3e50" stroke-width="2"/>
  <text x="400" y="825" class="text-label" text-anchor="middle">終了</text>

  <!-- Arrows -->
  <g id="arrows">
    <!-- Start to Username/Password -->
    <path d="M 400 100 L 400 130" class="flow-arrow"/>
    
    <!-- Username/Password to Valid? -->
    <path d="M 400 170 L 400 200" class="flow-arrow"/>
    
    <!-- Valid? No to Failed -->
    <path d="M 320 230 L 250 230" class="no-arrow"/>
    <text x="285" y="225" class="small-text" text-anchor="middle">いいえ</text>
    
    <!-- Valid? Yes to MFA Check -->
    <path d="M 400 260 L 400 300" class="yes-arrow"/>
    <text x="420" y="280" class="small-text">はい</text>
    
    <!-- MFA No to Success -->
    <path d="M 320 330 Q 200 530 325 740" class="no-arrow"/>
    <text x="285" y="325" class="small-text" text-anchor="middle">いいえ</text>
    
    <!-- MFA Yes to Method -->
    <path d="M 400 360 L 400 400" class="yes-arrow"/>
    <text x="420" y="380" class="small-text">はい</text>
    
    <!-- Method to SMS -->
    <path d="M 360 445 L 270 490" class="flow-arrow"/>
    <text x="310" y="465" class="small-text">SMS</text>
    
    <!-- Method to TOTP -->
    <path d="M 400 460 L 400 490" class="flow-arrow"/>
    <text x="420" y="475" class="small-text">TOTP</text>
    
    <!-- Method to Hardware -->
    <path d="M 440 445 L 530 490" class="flow-arrow"/>
    <text x="485" y="465" class="small-text">HW</text>
    
    <!-- SMS to Enter Code -->
    <path d="M 210 530 L 325 560" class="flow-arrow"/>
    
    <!-- TOTP to Enter Code -->
    <path d="M 400 530 L 400 560" class="flow-arrow"/>
    
    <!-- Hardware to Enter Code -->
    <path d="M 590 530 L 475 560" class="flow-arrow"/>
    
    <!-- Enter Code to Valid Code? -->
    <path d="M 400 600 L 400 630" class="flow-arrow"/>
    
    <!-- Valid Code? Yes to Success -->
    <path d="M 400 690 L 400 730" class="yes-arrow"/>
    <text x="420" y="710" class="small-text">はい</text>
    
    <!-- Valid Code? No to Retry -->
    <path d="M 480 660 L 470 660" class="no-arrow"/>
    <text x="500" y="655" class="small-text">いいえ</text>
    
    <!-- Retry < Max back to Enter Code -->
    <path d="M 550 630 Q 500 580 475 580" class="yes-arrow"/>
    <text x="520" y="605" class="small-text">&lt; 最大</text>
    
    <!-- Retry >= Max to Locked -->
    <path d="M 630 660 L 670 730" class="no-arrow"/>
    <text x="650" y="690" class="small-text">≥ 最大</text>
    
    <!-- Failed to End -->
    <path d="M 175 250 Q 175 820 350 820" class="flow-arrow"/>
    
    <!-- Success to End -->
    <path d="M 400 770 L 400 795" class="flow-arrow"/>
    
    <!-- Locked to End -->
    <path d="M 695 770 Q 695 820 450 820" class="flow-arrow"/>
  </g>
</svg>